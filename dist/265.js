"use strict";(self.webpackChunkspotify_demo=self.webpackChunkspotify_demo||[]).push([[265],{424:(t,e,r)=>{r.d(e,{A:()=>s});var a=r(7286),o=r(4871);const s=()=>{const{data:t}=(0,a.I)({queryKey:["client-credential-token"],queryFn:o.M}),e=t?.access_token;return e}},2704:(t,e,r)=>{r.d(e,{BI:()=>n,Q7:()=>i});var a=r(1083),o=r(5800),s=r(2229);const n=async t=>{try{return(await a.A.get(`${o.sH}/browse/new-releases?limit=12`,{headers:{Authorization:`Bearer ${t}`}})).data}catch(t){throw new Error("fail to fetch new releases")}},i=async(t,e)=>{try{return(await s.A.get(`${o.sH}/albums`,{params:{ids:t.join(",")},headers:{Authorization:`Bearer ${e}`}})).data}catch(t){throw console.error("getAlbumsByIds API Error:",t.response?.data||t.message),new Error("Failed to fetch albums by ids")}}},2801:(t,e,r)=>{r.d(e,{A:()=>i});var a=r(6475),o=r(1083),s=r(5800);var n=r(424);const i=t=>{const e=(0,n.A)();return(0,a.q)({queryKey:["search",t],queryFn:r=>{let{pageParam:a=0}=r;if(!e)throw new Error("no token available");return(async(t,e)=>{try{const r=new URLSearchParams;return r.append("q",e.q),r.append("type",e.type.join(",")),e.market&&r.append("market",e.market),e.limit&&r.append("limit",e.limit.toString()),e.offset&&r.append("offset",e.offset.toString()),e.include_external&&r.append("include_external",e.include_external),(await o.A.get(`${s.sH}/search?${r.toString()}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).data}catch(t){throw new Error("fail to search by keyword")}})(e,{...t,offset:a})},initialPageParam:0,getNextPageParam:t=>{const e=t.tracks?.next||t.artists?.next||t.albums?.next||t.audiobooks?.next||t.shows?.next||t.playlists?.next||t.episodes?.next;if(e){const t=new URL(e).searchParams.get("offset");return t?parseInt(t):void 0}}})}},3122:(t,e,r)=>{r.d(e,{A:()=>n});var a=r(6739),o=(r(6540),r(4848));const s=(0,a.Ay)("button")((t=>{let{theme:e}=t;return{backgroundColor:e.palette.primary.main,border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"rgba(0, 0, 0, 0.3) 0px 8px 8px 0px","&:focus":{outline:"none"}}})),n=()=>(0,o.jsx)(s,{children:(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{d:"M8 5v14l11-7z",fill:"black"})})})},3779:(t,e,r)=>{r.d(e,{A:()=>s});var a=r(6475),o=r(8511);const s=t=>{let{limit:e,offset:r}=t;return(0,a.q)({queryKey:["current-user-playlists"],queryFn:t=>{let{pageParam:r=0}=t;return(0,o.bP)({limit:e,offset:r})},initialPageParam:0,getNextPageParam:t=>{if(t.next){const e=new URL(t.next).searchParams.get("offset");return e?parseInt(e):void 0}}})}},4690:(t,e,r)=>{r.d(e,{k:()=>s});var a=r(9783),o=r(5800);const s=async()=>{const t=crypto.getRandomValues(new Uint8Array(64)).reduce(((t,e)=>t+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[e%62]),""),e=(r=await(async t=>{const e=(new TextEncoder).encode(t);return window.crypto.subtle.digest("SHA-256",e)})(t),btoa(String.fromCharCode(...new Uint8Array(r))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"));var r;const s=a.U6,n=o._q,i=a.iW,l=new URL("https://accounts.spotify.com/authorize");if(window.localStorage.setItem("code_verifier",t),s&&n){const t={response_type:"code",client_id:s,scope:i,code_challenge_method:"S256",code_challenge:e,redirect_uri:n};l.search=new URLSearchParams(Object.entries(t)).toString(),window.location.href=l.toString()}}},5265:(t,e,r)=>{r.r(e),r.d(e,{default:()=>J});var a=r(6540),o=r(6858),s=r(4142),n=r(8634),i=r(5124),l=r(1217),c=r(2764),d=r(2801),h=r(6928),p=r(2587),m=r(7286),x=r(2229);const u=async()=>{try{return(await x.A.get("/browse/categories?country=ko_KR&limit=20")).data}catch(t){throw new Error("Failed to fetch category")}};var g=r(2412),y=r(6739),A=r(4848);const f=(0,y.Ay)(g.A,{shouldForwardProp:t=>"bgcolor"!==t})((t=>{let{bgcolor:e}=t;return{aspectRatio:"3 / 2",borderRadius:16,padding:16,display:"flex",flexDirection:"column",justifyContent:"space-between",color:"#fff",position:"relative",overflow:"hidden",backgroundColor:e}})),w=(0,y.Ay)("img")({width:"100%",height:"100%",objectFit:"contain",opacity:.9,transform:"rotate(15deg)",transformOrigin:"bottom right"}),b=(0,y.Ay)(o.A)({position:"absolute",bottom:-18,right:0,width:"50%",aspectRatio:"1/1",overflow:"visible"}),j=t=>{let{name:e,image:r}=t;const a=(()=>{const t=["#EF9A9A","#CE93D8","#90CAF9","#A5D6A7","#FFF59D","#FFCC80"];return t[Math.floor(Math.random()*t.length)]})();return(0,A.jsxs)(f,{bgcolor:a,children:[(0,A.jsx)(i.A,{variant:"h6",fontWeight:600,children:e}),(0,A.jsx)(b,{children:(0,A.jsx)(w,{src:r,alt:e})})]})};var v=r(1083),k=r(5800),S=r(424);var I=r(2704),C=r(8511),P=r(2014),F=r(73),B=r(6773),E=r(5673),z=r(3779);const R=t=>{let{open:e,anchorEl:r,onClose:a,onSelect:o}=t;const{data:s}=(0,z.A)({limit:20,offset:0}),n=s?.pages.flatMap((t=>t.items))??[];return(0,A.jsxs)(P.Ay,{open:e,anchorEl:r,onClose:a,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,A.jsx)(i.A,{variant:"h6",sx:{p:1.5,fontWeight:600},children:"My Playlists"}),(0,A.jsx)(F.A,{dense:!0,sx:{width:250},children:n.map((t=>(0,A.jsx)(B.A,{onClick:()=>{t.id&&(o(t.id),a())},children:(0,A.jsx)(E.A,{primary:t.name})},t.id)))})]})},_=t=>{let{track:e}=t;return(0,A.jsxs)(o.A,{p:2,children:[(0,A.jsx)(i.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Top Result"}),(0,A.jsx)(o.A,{component:"img",src:e.album?.images[0]?.url,alt:"앨범 이미지",sx:{width:100,height:100,objectFit:"cover",borderRadius:1,marginBottom:2}}),(0,A.jsx)(i.A,{variant:"h6",children:e.name}),(0,A.jsx)(i.A,{variant:"body2",color:"textSecondary",children:e.artists?.map((t=>t.name)).join(", ")})]})};var W=r(8828),q=r(4026),$=r(1361),M=r(4963),U=r(2077);const L=(0,y.Ay)(o.A)({opacity:0,transition:"opacity 0.3s ease",cursor:"pointer","&:hover":{opacity:1}}),O=(0,y.Ay)(W.A)({"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)","& .add-button":{opacity:1}}}),N=t=>{if("number"!=typeof t)return"-";const e=Math.floor(t/1e3);return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`},D=t=>{let{tracks:e,onAddClick:r}=t;return(0,A.jsxs)(o.A,{children:[(0,A.jsx)(i.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Songs"}),(0,A.jsx)(q.A,{sx:{width:"100%"},children:(0,A.jsx)($.A,{children:e.slice(0,5).map(((t,e)=>(0,A.jsxs)(O,{sx:{height:50},children:[(0,A.jsx)(M.A,{sx:{width:60,p:1,pl:1,borderBottom:"none"},children:(0,A.jsx)(o.A,{children:(0,A.jsx)(o.A,{component:"img",src:t.album?.images[0]?.url,alt:"앨범 이미지",sx:{width:40,height:40,borderRadius:1,objectFit:"cover"}})})}),(0,A.jsxs)(M.A,{sx:{pl:1,py:.5,borderBottom:"none",width:"100%"},children:[(0,A.jsx)(i.A,{variant:"body2",fontWeight:"bold",noWrap:!0,children:t.name}),(0,A.jsx)(i.A,{variant:"caption",color:"text.secondary",noWrap:!0,children:t.artists?.map((t=>t.name)).join(", ")})]}),(0,A.jsx)(M.A,{align:"right",sx:{px:1,py:.5,borderBottom:"none",whiteSpace:"nowrap",position:"relative"},children:(0,A.jsx)(L,{className:"add-button",onClick:e=>r(e,t),children:(0,A.jsx)(U.A,{sx:{fontSize:20}})})}),(0,A.jsx)(M.A,{align:"right",sx:{px:1,py:.5,borderBottom:"none"},children:N(t.duration_ms)})]},e)))})})]})};var K=r(3122);const T=(0,y.Ay)(o.A)({position:"relative",display:"flex",flexDirection:"column",alignItems:"center",padding:"16px",borderRadius:"12px",overflow:"hidden",cursor:"pointer","&:hover .overlay":{opacity:1},"&:hover .play-button":{opacity:1,transform:"translateY(0)"}}),H=(0,y.Ay)(o.A)({position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"12px",opacity:0,pointerEvents:"none",transition:"opacity 0.3s ease-in-out",zIndex:1}),Y=(0,y.Ay)(o.A)({position:"absolute",bottom:16,right:16,opacity:0,transition:"all 0.3s ease-in-out",zIndex:2}),Q=t=>{let{artists:e}=t;return(0,A.jsxs)(o.A,{p:2,children:[(0,A.jsx)(i.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Artists"}),(0,A.jsx)(l.A,{container:!0,spacing:2,children:e.filter((t=>!!t?.images?.[0])).slice(0,6).map((t=>(0,A.jsx)(l.A,{size:{xs:6,sm:4,md:2},children:(0,A.jsxs)(T,{children:[(0,A.jsx)(H,{className:"overlay"}),(0,A.jsx)(o.A,{component:"img",src:t.images?.[0]?.url,alt:t.name,sx:{width:{xs:80,sm:100,md:120},height:{xs:80,sm:100,md:120},borderRadius:"50%",objectFit:"cover",zIndex:0}}),(0,A.jsx)(i.A,{variant:"body2",align:"center",noWrap:!0,sx:{mt:1,zIndex:2},children:t.name}),(0,A.jsx)(i.A,{variant:"caption",color:"textSecondary",noWrap:!0,sx:{zIndex:2},children:"Artist"}),(0,A.jsx)(Y,{className:"play-button",children:(0,A.jsx)(K.A,{})})]})},t.id)))})]})},V=t=>{let{albums:e}=t;return(0,A.jsxs)(o.A,{p:2,children:[(0,A.jsx)(i.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Albums"}),(0,A.jsx)(l.A,{container:!0,spacing:2,children:e.filter((t=>!!t.images?.[0])).slice(0,6).map((t=>(0,A.jsx)(l.A,{size:{xs:6,sm:4,md:2},children:(0,A.jsxs)(o.A,{display:"flex",flexDirection:"column",alignItems:"center",children:[(0,A.jsx)(o.A,{component:"img",src:t.images[0].url,alt:t.name,sx:{width:{xs:80,sm:100,md:120},height:{xs:80,sm:100,md:120},borderRadius:1,objectFit:"cover",mb:1}}),(0,A.jsx)(i.A,{variant:"body2",noWrap:!0,sx:{maxWidth:{xs:80,sm:100,md:120},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),(0,A.jsx)(i.A,{variant:"caption",color:"textSecondary",noWrap:!0,sx:{maxWidth:{xs:80,sm:100,md:120},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.artists.map((t=>t.name)).join(", ")})]})},t.id)))})]})};var X=r(4690);const Z=t=>{let{trackList:e,artistIds:r,albumIds:o}=t;const{data:s}=(t=>{const e=(0,S.A)();return(0,m.I)({queryKey:["artists",t],queryFn:()=>(async(t,e)=>{try{return(await v.A.get(`${k.sH}/artists`,{params:{ids:t.join(",")},headers:{Authorization:`Bearer ${e}`}})).data.artists}catch(t){throw console.error("getArtistsByIds API Error:",t),new Error("Failed to fetch artist information")}})(t,e),enabled:t.length>0,retry:!1})})(r),{data:n}=(t=>{const e=(0,S.A)();return(0,m.I)({queryKey:["albums",t],queryFn:()=>(0,I.Q7)(t,e),enabled:t.length>0,staleTime:3e5})})(o),i=n?.albums??[],[c,d]=(0,a.useState)(null),[h,p]=(0,a.useState)(null);if(e.length<4)return null;const x=new Map(s?.map((t=>[t.id,t]))??[]),u=new Map(i.map((t=>[t.id,t])));return(0,A.jsxs)(l.A,{container:!0,spacing:2,children:[(0,A.jsx)(l.A,{size:{xs:12,sm:6},children:(0,A.jsx)(_,{track:e[0]})}),(0,A.jsx)(l.A,{size:{xs:12,sm:6},children:(0,A.jsx)(D,{tracks:e.slice(0,5),onAddClick:(t,e)=>{if(!localStorage.getItem("access_token"))return alert("로그인이 필요합니다."),void(0,X.k)();p(e),d(t.currentTarget)}})}),(0,A.jsxs)(l.A,{size:{xs:12},children:[" ",(0,A.jsx)(Q,{artists:[...x.values()]})]}),(0,A.jsxs)(l.A,{size:{xs:12},children:[" ",(0,A.jsx)(V,{albums:[...u.values()]})]}),h&&(0,A.jsx)(R,{open:Boolean(c),anchorEl:c,onClose:()=>{d(null)},onSelect:async t=>{h?.uri&&await(async(t,e)=>{try{await(0,C.YO)(t,{uris:[e]}),alert("플레이리스트에 추가되었습니다.")}catch(t){alert("추가 실패")}})(t,h.uri)}})]})};var G=r(5647);const J=()=>{const[t,e]=(0,a.useState)(""),r=(0,G.Zp)(),{keyword:x}=(0,G.g)(),g=!!localStorage.getItem("access_token"),{data:y,isLoading:f,isFetchingNextPage:w}=(0,d.A)({q:t,type:[h.C.Track]}),b=f||w,v=""!==t.trim(),k=y?.pages.flatMap((t=>t.tracks?.items??[]))??[],S=[...new Set(k.flatMap((t=>t.artists?.map((t=>t.id))??[])).filter((t=>!!t)))],I=[...new Set(k.map((t=>t.album?.id)).filter((t=>!!t)))],{data:C,isLoading:P}=(0,m.I)({queryKey:["category"],queryFn:u});return(0,a.useEffect)((()=>{x&&t!==decodeURIComponent(x)&&e(decodeURIComponent(x))}),[x]),(0,A.jsxs)(o.A,{p:3,sx:{width:"100%",maxWidth:"1440px",margin:"0 auto",overflowX:"hidden"},children:[(0,A.jsx)(s.A,{value:t,onChange:t=>{const a=t.target.value;e(a),a.trim()&&a!==x?r(`/search/${encodeURIComponent(a.trim())}`):a.trim()||r("/search")},placeholder:"What do you want to play?",InputProps:{startAdornment:(0,A.jsx)(n.A,{position:"start",children:(0,A.jsx)(c.A,{sx:{color:"white"}})})},sx:{width:{xs:"100%",sm:"400px",md:"500px"},"& .MuiOutlinedInput-root":{backgroundColor:"#424242",borderRadius:"24px",color:"#fff"},marginBottom:"2rem"}}),!v&&!g&&(0,A.jsx)(o.A,{textAlign:"center",mt:4,children:(0,A.jsx)(i.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"카테고리를 보려면 Spotify 로그인이 필요합니다."})}),!v&&g&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(i.A,{variant:"h5",fontWeight:600,mb:2,children:"Browse All"}),P?(0,A.jsx)(p.A,{}):(0,A.jsx)(o.A,{sx:{maxHeight:"72vh",overflowY:"auto",pr:1,scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:(0,A.jsx)(l.A,{container:!0,spacing:2,children:C?.categories.items.map((t=>(0,A.jsx)(l.A,{size:{xs:12,sm:6,md:4},children:(0,A.jsx)(j,{name:t.name,image:t.icons?.[0]?.url})},t.id)))})})]}),v&&b&&(0,A.jsx)(p.A,{}),v&&!b&&0===k.length&&(0,A.jsxs)(i.A,{variant:"h6",my:4,children:["No results for: ",(0,A.jsx)("strong",{children:t})]}),v&&k.length>=4&&(0,A.jsx)(Z,{trackList:k.filter((t=>!!t.id)),artistIds:S,albumIds:I})]})}},6928:(t,e,r)=>{r.d(e,{C:()=>a});let a=function(t){return t.Track="track",t.Album="album",t.Playlist="playlist",t.Show="show",t.Episode="episode",t.AudioBook="audiobook",t.Artist="artist",t}({})},8511:(t,e,r)=>{r.d(e,{Dg:()=>i,Nt:()=>l,YO:()=>c,bP:()=>s,bt:()=>n});var a=r(2229),o=r(4871);const s=async t=>{let{limit:e,offset:r}=t;try{return(await a.A.get("/me/playlists",{params:{limit:e,offset:r}})).data}catch(t){throw new Error("fail to fetch current user playlist")}},n=async t=>{try{return(await a.A.get(`/playlists/${t.playlist_id}`,{params:t})).data}catch(t){throw new Error("fail to fetch playlist detail")}},i=async t=>{const e=await(0,o.M)(),{playlist_id:r,...s}=t;try{return(await a.A.get(`playlists/${t.playlist_id}/tracks`,{params:s,headers:{Authorization:`Bearer ${e.access_token}`}})).data}catch(t){throw console.error("getPlaylistItems API Error:",t),new Error("fail to fetch playlist items")}},l=async(t,e)=>{try{const{name:r,playlistPublic:o,collaborative:s,description:n}=e;return(await a.A.post(`/users/${t}/playlists`,{name:r,public:o,collaborative:s,description:n})).data}catch(t){throw new Error("fail to create playlist")}},c=async(t,e)=>{try{return(await a.A.post(`/playlists/${t}/tracks`,e)).data}catch(t){throw new Error("fail to add playlist")}}}}]);
//# sourceMappingURL=265.js.map?ver=717b600d002a67c73f9d
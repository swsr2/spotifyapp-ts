"use strict";(self.webpackChunkspotify_demo=self.webpackChunkspotify_demo||[]).push([[967],{7:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(2142),a=r(2454),n=r(5124),i=(r(6540),r(4848));const o=e=>{let{errorMessage:t}=e;return(0,i.jsxs)(s.A,{severity:"error",children:[(0,i.jsx)(a.A,{children:"Error"}),(0,i.jsx)(n.A,{variant:"body1",children:t})]})}},424:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(7286),a=r(4871);const n=()=>{const{data:e}=(0,s.I)({queryKey:["client-credential-token"],queryFn:a.M}),t=e?.access_token;return t}},2801:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(6475),a=r(1083),n=r(5800);var i=r(424);const o=e=>{const t=(0,i.A)();return(0,s.q)({queryKey:["search",e],queryFn:r=>{let{pageParam:s=0}=r;if(!t)throw new Error("no token available");return(async(e,t)=>{try{const r=new URLSearchParams;return r.append("q",t.q),r.append("type",t.type.join(",")),t.market&&r.append("market",t.market),t.limit&&r.append("limit",t.limit.toString()),t.offset&&r.append("offset",t.offset.toString()),t.include_external&&r.append("include_external",t.include_external),(await a.A.get(`${n.sH}/search?${r.toString()}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).data}catch(e){throw new Error("fail to search by keyword")}})(t,{...e,offset:s})},initialPageParam:0,getNextPageParam:e=>{const t=e.tracks?.next||e.artists?.next||e.albums?.next||e.audiobooks?.next||e.shows?.next||e.playlists?.next||e.episodes?.next;if(t){const e=new URL(t).searchParams.get("offset");return e?parseInt(e):void 0}}})}},6928:(e,t,r)=>{r.d(t,{C:()=>s});let s=function(e){return e.Track="track",e.Album="album",e.Playlist="playlist",e.Show="show",e.Episode="episode",e.AudioBook="audiobook",e.Artist="artist",e}({})},7967:(e,t,r)=>{r.r(t),r.d(t,{default:()=>D});var s=r(6540),a=r(5647),n=r(6739),i=r(8344),o=r(6858),l=r(5124),c=r(4026),d=r(6700),h=r(8828),x=r(4963),u=r(1361),p=r(5692),m=r(3110),y=r(7286),A=r(8511);var g=r(6475),j=r(5800);var f=r(2587),w=r(7);var b=r(4142),k=r(8634),v=r(2801),P=r(6928),_=r(431),S=r(5985),N=r(3959),q=r(7097);var E=r(7665),I=r(4848);const B=e=>{let{list:t,fetchNextPage:r,hasNextPage:n,isFetchingNextPage:m}=e;const{ref:y,inView:g}=(0,p.Wx)(),{mutate:j}=(0,q.n)({mutationFn:e=>{let{playlistId:t,params:r}=e;return(0,A.YO)(t,r)},onSuccess:(e,t)=>{console.log("트랙 추가 성공:",e.snapshot_id)},onError:e=>{console.error("트랙 추가 실패:",e.message)}}),{id:w}=(0,a.g)(),[b,k]=(0,s.useState)(!1),v=(0,E.jE)(),[P,B]=(0,s.useState)(null);return(0,s.useEffect)((()=>{g&&n&&!m&&r?.()}),[g,n,m,r]),console.log("searchlist",t),0===t.length?null:(0,I.jsxs)(o.A,{children:[(0,I.jsxs)(c.A,{stickyHeader:!0,children:[(0,I.jsx)(d.A,{children:(0,I.jsxs)(h.A,{children:[(0,I.jsx)(x.A,{children:"앨범"}),(0,I.jsx)(x.A,{children:"제목"}),(0,I.jsx)(x.A,{children:"아티스트"}),(0,I.jsx)(x.A,{align:"center",children:"플레이리스트"})]})}),(0,I.jsxs)(u.A,{children:[t.map((e=>(0,I.jsxs)(h.A,{hover:!0,children:[(0,I.jsx)(x.A,{sx:{borderBottom:"none"},children:(0,I.jsx)(i.A,{src:e.album?.images?.[0]?.url,alt:e.name,variant:"square",sx:{width:50,height:50,borderRadius:1}})}),(0,I.jsx)(x.A,{sx:{borderBottom:"none"},children:(0,I.jsx)(l.A,{fontWeight:600,children:e.name})}),(0,I.jsx)(x.A,{sx:{borderBottom:"none"},children:e.artists?.map((e=>e.name)).join(", ")}),(0,I.jsx)(x.A,{align:"center",sx:{borderBottom:"none"},children:(0,I.jsx)(_.A,{size:"small",color:"secondary",onClick:()=>{return e.uri&&(t=e.uri,void(w&&j({playlistId:w,params:{uris:[t],position:0}},{onSuccess:()=>{k(!0),B(w)}})));var t},children:(0,I.jsx)(N.A,{})})})]},e.id))),(0,I.jsx)(h.A,{children:(0,I.jsx)(x.A,{colSpan:5,sx:{borderBottom:"none"},children:(0,I.jsx)("div",{ref:y,style:{height:"1px"}})})}),m&&(0,I.jsx)(h.A,{children:(0,I.jsx)(x.A,{colSpan:5,sx:{borderBottom:"none"},children:(0,I.jsx)(f.A,{})})})]})]}),(0,I.jsx)(S.A,{open:b,autoHideDuration:2e3,onClose:()=>{k(!1),P&&(v.refetchQueries({queryKey:["playlist-detail",P]}),v.refetchQueries({queryKey:["playlist-items",P]}),B(null))},message:"플레이 리스트에 저장되었습니다!",anchorOrigin:{vertical:"bottom",horizontal:"center"}})]})};var F=r(2764);const C=()=>{const[e,t]=(0,s.useState)(""),{data:r,fetchNextPage:a,hasNextPage:n,isFetchingNextPage:i,isLoading:o}=(0,v.A)({q:e,type:[P.C.Track]}),c=r?.pages.flatMap((e=>e.tracks?.items??[]))??[],d=o||i,h=""!==e.trim();return(0,I.jsxs)("div",{children:[(0,I.jsx)(l.A,{variant:"h1",my:"10px",children:"Let's find somthing for your playlist"}),(0,I.jsx)(b.A,{value:e,onChange:e=>{t(e.target.value)},placeholder:"Search for tracks...",InputProps:{startAdornment:(0,I.jsx)(k.A,{position:"start",children:(0,I.jsx)(F.A,{})})},sx:{width:{xs:"100%",sm:"400px",md:"500px"}}}),!h&&(0,I.jsx)(I.Fragment,{}),h&&d&&(0,I.jsx)(f.A,{}),h&&!d&&0===c.length&&(0,I.jsxs)(l.A,{variant:"h6",my:"20px",children:["No results for: ",(0,I.jsx)("strong",{children:e})]}),c.length>0&&(0,I.jsx)(B,{list:c,fetchNextPage:a,hasNextPage:n,isFetchingNextPage:i})]})},$=(0,n.Ay)(h.A)((e=>{let{theme:t}=e;return{cursor:"pointer","&:hover":{backgroundColor:"rgba(255,255,255,0.08)"},"& td":{borderBottom:"none"}}})),M=e=>{let{item:t,index:r}=e;const s=t.added_at?new Date(t.added_at).toISOString().split("T")[0]:"Unknown";return(0,I.jsxs)($,{children:[(0,I.jsx)(x.A,{children:r}),(0,I.jsx)(x.A,{children:t.track.name||"No name"}),(0,I.jsx)(x.A,{children:(a=t.track,"description"in a?"N/A":t.track.album?.name)}),(0,I.jsx)(x.A,{children:s||"Unknown"}),(0,I.jsx)(x.A,{children:(e=>{if(void 0===e)return"Unknown";const t=Math.floor(e/1e3);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`})(t.track.duration_ms)||"Unknown"})]});var a},z=(0,n.Ay)(i.A)((e=>{let{theme:t}=e;return{borderRadius:2*t.shape.borderRadius,width:200,height:200,[t.breakpoints.down("md")]:{width:140,height:140},[t.breakpoints.down("sm")]:{width:120,height:120}}})),R=e=>(0,m.F0)(e)&&e.response?.status?e.response.status:null,D=()=>{const{id:e}=(0,a.g)(),t=e??"",r=(()=>{const[e,t]=(0,s.useState)("ok"),r=(0,a.Zp)(),n=(0,a.zy)(),i=(0,s.useRef)(!1);return(0,s.useEffect)((()=>{localStorage.getItem("access_token")||i.current||(i.current=!0,localStorage.removeItem("access_token"),alert("잘못된 접근입니다. 로그인 후 다시 이용해주세요."),r("/",{replace:!0}),t("unauthorized"),window.history.replaceState({},document.title,"/"))}),[r,n]),e})(),{ref:n,inView:i}=(0,p.Wx)(),{data:m,isLoading:b,error:k}=(E={playlist_id:t},(0,y.I)({queryKey:["playlist-detail",E.playlist_id],queryFn:()=>(0,A.bt)(E),enabled:!!E.playlist_id})),{data:v,error:P,hasNextPage:_,isFetchingNextPage:S,fetchNextPage:N}=(e=>(0,g.q)({queryKey:["playlist-items",e.playlist_id],queryFn:t=>{let{pageParam:r=0}=t;return(0,A.Dg)({playlist_id:e.playlist_id,offset:r,limit:j.Wt})},initialPageParam:0,getNextPageParam:e=>{if(e.next){const t=new URL(e.next).searchParams.get("offset");return t?parseInt(t):void 0}}}))({playlist_id:t}),q=k&&401!==R(k)||P&&401!==R(P);var E;if((0,s.useEffect)((()=>{i&&_&&!S&&N()}),[i,_,S,N]),"redirect"===r||"unauthorized"===r)return null;if(b)return(0,I.jsx)(f.A,{});if(q)return(0,I.jsx)(w.A,{errorMessage:"플레이리스트를 불러오는 데 실패했습니다."});if(!m?.name)return(0,I.jsx)(w.A,{errorMessage:"잘못된 플레이리스트입니다."});const B=m.images?.[0]?.url||"/music_album.png";return(0,I.jsxs)("div",{children:[(0,I.jsx)(o.A,{gap:4,children:(0,I.jsxs)(o.A,{display:"flex",alignItems:{xs:"flex-start",sm:"center"},flexDirection:{xs:"column",sm:"row"},gap:4,sx:{pl:1.5},children:[(0,I.jsx)(z,{variant:"square",style:{background:"gray",borderRadius:"8px"},src:B,alt:m.name}),(0,I.jsxs)(o.A,{sx:{mt:{xs:2,sm:0},textAlign:"left",width:"100%"},children:[(0,I.jsx)(l.A,{variant:"h1",fontSize:28,fontWeight:600,children:m.name}),(0,I.jsxs)(l.A,{variant:"subtitle1",color:"text.secondary",mt:1,children:["by ",m.owner.display_name]}),m.description&&(0,I.jsx)(l.A,{mt:2,variant:"body1",color:"text.primary",children:m.description}),(0,I.jsxs)(l.A,{mt:2,variant:"body2",color:"text.secondary",children:["곡 수: ",m.tracks?.total??0]})]})]})}),(0,I.jsx)(o.A,{sx:{maxHeight:"520px",overflowY:"scroll","::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",msOverflowStyle:"none"},children:0===m?.tracks?.total?(0,I.jsx)(C,{}):(0,I.jsxs)(c.A,{stickyHeader:!0,sx:{backgroundColor:"background.paper"},children:[(0,I.jsx)(d.A,{children:(0,I.jsxs)(h.A,{children:[(0,I.jsx)(x.A,{children:"#"}),(0,I.jsx)(x.A,{children:"Title"}),(0,I.jsx)(x.A,{children:"Album"}),(0,I.jsx)(x.A,{children:"Date added"}),(0,I.jsx)(x.A,{children:"Duration"})]})}),(0,I.jsxs)(u.A,{children:[v?.pages.flatMap(((e,t)=>e.items.map(((e,r)=>(0,I.jsx)(M,{item:e,index:t*j.Wt+r+1},e.track.id+"_"+r))))),(0,I.jsx)(h.A,{children:(0,I.jsx)(x.A,{colSpan:5,sx:{borderBottom:"none"},children:(0,I.jsx)("div",{ref:n,style:{height:"1px"}})})}),S&&(0,I.jsx)(h.A,{children:(0,I.jsx)(x.A,{colSpan:5,sx:{borderBottom:"none"},children:(0,I.jsx)(f.A,{})})})]})]})})]})}},8511:(e,t,r)=>{r.d(t,{Dg:()=>o,Nt:()=>l,YO:()=>c,bP:()=>n,bt:()=>i});var s=r(2229),a=r(4871);const n=async e=>{let{limit:t,offset:r}=e;try{return(await s.A.get("/me/playlists",{params:{limit:t,offset:r}})).data}catch(e){throw new Error("fail to fetch current user playlist")}},i=async e=>{try{return(await s.A.get(`/playlists/${e.playlist_id}`,{params:e})).data}catch(e){throw new Error("fail to fetch playlist detail")}},o=async e=>{const t=await(0,a.M)(),{playlist_id:r,...n}=e;try{return(await s.A.get(`playlists/${e.playlist_id}/tracks`,{params:n,headers:{Authorization:`Bearer ${t.access_token}`}})).data}catch(e){throw console.error("getPlaylistItems API Error:",e),new Error("fail to fetch playlist items")}},l=async(e,t)=>{try{const{name:r,playlistPublic:a,collaborative:n,description:i}=t;return(await s.A.post(`/users/${e}/playlists`,{name:r,public:a,collaborative:n,description:i})).data}catch(e){throw new Error("fail to create playlist")}},c=async(e,t)=>{try{return(await s.A.post(`/playlists/${e}/tracks`,t)).data}catch(e){throw new Error("fail to add playlist")}}}}]);
//# sourceMappingURL=967.js.map?ver=717b600d002a67c73f9d